<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø¥Ø¶Ø§ÙØ© Ø£ÙƒØ³Ø³ÙˆØ§Ø± Ø¬Ø¯ÙŠØ¯ â€” Ø§Ù„ØµÙ‚Ø±ÙŠ Ù„Ù„Ø§ØªØµØ§Ù„Ø§Øª</title>

  <!-- Ù†ÙØ³ Ø®Ø·ÙˆØ·/Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„ØªÙŠ ØªØ³ØªØ®Ø¯Ù…Ù‡Ø§ -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

  <style>
    body { font-family: 'Cairo', sans-serif; background-color: #f8f9fa; padding-top: 70px; }
    .navbar { 
      background-color: #2c3e50; 
      position: fixed; 
      top: 0; 
      width: 100%; 
      z-index: 1030; 
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .navbar-brand, .nav-link { color: white !important; }
    .card { margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .btn-primary { background-color: #2c3e50; border-color: #2c3e50; }
    .btn-primary:hover { background-color: #1a252f; border-color: #1a252f; }
  </style>
</head>
<body>

  <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ -->
  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
      <a class="navbar-brand" href="index.html">Ø§Ù„ØµÙ‚Ø±ÙŠ Ù„Ù„Ø§ØªØµØ§Ù„Ø§Øª</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link" href="dashboard.html"><i class="fas fa-tachometer-alt"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
          </li>

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="inventoryDropdown" role="button" data-bs-toggle="dropdown">
              <i class="fas fa-boxes"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="inventory_summary.html"><i class="fas fa-chart-bar"></i> Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</a></li>
              <li><a class="dropdown-item" href="search.html"><i class="fas fa-search"></i> Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item active" href="add_accessory.html"><i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø£ÙƒØ³Ø³ÙˆØ§Ø±</a></li>
              <li><a class="dropdown-item" href="list_accessories_simple.html"><i class="fas fa-box"></i> Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø£ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª</a></li>
            </ul>
          </li>

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="salesDropdown" role="button" data-bs-toggle="dropdown">
              <i class="fas fa-shopping-cart"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="list_sales.html"><i class="fas fa-list"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</a></li>
              <li><a class="dropdown-item" href="create_sale.html"><i class="fas fa-plus-circle"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹ Ø¬Ø¯ÙŠØ¯Ø©</a></li>
            </ul>
          </li>

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="phoneDropdown" role="button" data-bs-toggle="dropdown">
              <i class="fas fa-mobile-alt"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆØ§ØªÙ
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="add_new_phone.html"><i class="fas fa-mobile"></i> Ù‡Ø§ØªÙ Ø¬Ø¯ÙŠØ¯</a></li>
              <li><a class="dropdown-item" href="add_used_phone.html"><i class="fas fa-mobile-alt"></i> Ù‡Ø§ØªÙ Ù…Ø³ØªØ¹Ù…Ù„</a></li>
            </ul>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© (Ù†ÙØ³ ØªØ®Ø·ÙŠØ·Ùƒ Ø§Ù„Ø£ØµÙ„ÙŠ) -->
  <div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2><i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø£ÙƒØ³Ø³ÙˆØ§Ø± Ø¬Ø¯ÙŠØ¯</h2>
    </div>

    <div class="row">
      <div class="col-md-8 mx-auto">
        <div class="card">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="fas fa-box"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£ÙƒØ³Ø³ÙˆØ§Ø±</h5>
          </div>
          <div class="card-body">
            <!-- ÙˆØ§Ø¬Ù‡Ø© ÙÙ‚Ø·: Ù„Ø§ Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø®Ø§Ø¯Ù… -->
            <form action="#" onsubmit="return false;">
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="name" class="form-label">Ø§Ø³Ù… Ø§Ù„Ø£ÙƒØ³Ø³ÙˆØ§Ø± *</label>
                    <input type="text" class="form-control" id="name" required>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="category" class="form-label">Ø§Ù„ÙØ¦Ø© *</label>
                    <div class="input-group">
                      <select class="form-select" id="category" required>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©</option>
                        <!-- Ø§ØªØ±ÙƒÙ‡Ø§ ÙØ§Ø±ØºØ© Ø§Ù„Ø¢Ù†Ø› Ø³ØªÙ…Ù„Ø¤Ù‡Ø§ Ø¨Ø¬Ø§ÙØ§Ø³ÙƒØ±Ø¨Øª Ù„Ø§Ø­Ù‚Ù‹Ø§ -->
                      </select>
                      <button class="btn btn-outline-success" type="button" onclick="demoAddCategory()">
                        <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ©
                      </button>
                      <button class="btn btn-outline-danger" type="button" onclick="demoDeleteCategory()">
                        <i class="fas fa-trash"></i> Ø­Ø°Ù
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="mb-3">
                <label for="description" class="form-label">Ø§Ù„ÙˆØµÙ</label>
                <textarea class="form-control" id="description" rows="3"></textarea>
              </div>

              <div class="row">
                <div class="col-md-4">
                  <div class="mb-3">
                    <label for="purchase_price" class="form-label">Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ (Ù…Ø¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©) *</label>
                    <input type="text" class="form-control arabic-number-field" id="purchase_price" required placeholder="Ù…Ø«Ø§Ù„: Ù¡Ù¢Ù£.Ù¤Ù¥ Ø£Ùˆ 123.45">
                    <small class="text-muted">ÙŠÙ‚Ø¨Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</small>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label for="selling_price" class="form-label">Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ (Ù…Ø¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©) *</label>
                    <input type="text" class="form-control arabic-number-field" id="selling_price" required placeholder="Ù…Ø«Ø§Ù„: Ù¢Ù Ù .Ù§Ù¥ Ø£Ùˆ 200.75">
                    <small class="text-muted">ÙŠÙ‚Ø¨Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</small>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label for="quantity" class="form-label">Ø§Ù„ÙƒÙ…ÙŠØ© *</label>
                    <input type="text" class="form-control arabic-number-field" id="quantity" value="1" required placeholder="Ù…Ø«Ø§Ù„: Ù¡Ù  Ø£Ùˆ 10">
                    <small class="text-muted">ÙŠÙ‚Ø¨Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</small>
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="supplier" class="form-label">Ø§Ù„Ù…ÙˆØ±Ø¯</label>
                    <input type="text" class="form-control" id="supplier">
                  </div>
                </div>
              </div>

              <div class="mb-3">
                <label for="notes" class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                <textarea class="form-control" id="notes" rows="3"></textarea>
              </div>

              <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <button type="submit" class="btn btn-success btn-lg" onclick="demoSave()">
                  <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø£ÙƒØ³Ø³ÙˆØ§Ø±
                </button>
              </div>
            </form>
            <!-- /form -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù†ÙØ³Ù‡Ø§ -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Firebase Configuration -->
  <script type="module" src="js/firebase-config.js"></script>
  <script type="module" src="js/firebase-database.js"></script>
  <script type="module" src="js/firebase-storage-manager.js"></script>

  <!-- Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ -->
  <script>
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
    const VAT_RATE = 0.15; // 15% Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª Ù…Ù† Firebase
    async function loadCategories() {
      const categorySelect = document.getElementById('category');
      categorySelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©</option>';
      
      try {
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙØ¦Ø§Øª Ù…Ù† Firebase
        if (window.storage && window.storage.isFirebaseAvailable) {
          const categories = await window.storage.getAccessoryCategories();
          if (categories && categories.length > 0) {
            categories.forEach(cat => {
              const option = document.createElement('option');
              option.value = cat.name;
              option.textContent = cat.arabic_name;
              categorySelect.appendChild(option);
            });
            console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ÙØ¦Ø§Øª Ø§Ù„Ø£ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª Ù…Ù† Firebase');
            return;
          }
        }
        
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙƒØ¨Ø¯ÙŠÙ„
        const defaultCategories = [
          { name: 'case', arabic_name: 'Ø£ØºÙ„ÙØ©' },
          { name: 'charger', arabic_name: 'Ø´ÙˆØ§Ø­Ù†' },
          { name: 'screen_protector', arabic_name: 'Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø´Ø§Ø´Ø©' },
          { name: 'cable', arabic_name: 'ÙƒØ§Ø¨Ù„Ø§Øª' },
          { name: 'headphone', arabic_name: 'Ø³Ù…Ø§Ø¹Ø§Øª' },
          { name: 'other', arabic_name: 'Ø£Ø®Ø±Ù‰' }
        ];
        
        defaultCategories.forEach(cat => {
          const option = document.createElement('option');
          option.value = cat.name;
          option.textContent = cat.arabic_name;
          categorySelect.appendChild(option);
        });
        
        console.log('âš ï¸ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª:', error);
      }
    }

    // Ø¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
    function showAlert(type, message) {
      const alertDiv = document.createElement('div');
      alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
      alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
      alertDiv.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-triangle' : 'info-circle'}"></i>
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      `;
      
      document.body.appendChild(alertDiv);
      
      setTimeout(() => {
        if (alertDiv.parentNode) {
          alertDiv.remove();
        }
      }, 5000);
    }

    // ØªÙˆÙ„ÙŠØ¯ Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯
    function generateId() {
      return Date.now().toString(36) + Math.random().toString(36).substr(2);
    }

    // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¥Ù„Ù‰ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© - Ø·Ø±ÙŠÙ‚Ø© Ù…Ø­Ø³Ù†Ø©
    function convertArabicToEnglishNumbers(str) {
      if (!str) return '';
      
      // Ø®Ø±ÙŠØ·Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
      const arabicToEnglish = {
        'Ù ': '0', 'Ù¡': '1', 'Ù¢': '2', 'Ù£': '3', 'Ù¤': '4',
        'Ù¥': '5', 'Ù¦': '6', 'Ù§': '7', 'Ù¨': '8', 'Ù©': '9'
      };
      
      return str.toString().replace(/[Ù -Ù©]/g, function(match) {
        return arabicToEnglish[match] || match;
      });
    }

    // ØªØ­ÙˆÙŠÙ„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ù‚Ù„ ÙˆØ¥Ø±Ø¬Ø§Ø¹ Ø±Ù‚Ù… ØµØ­ÙŠØ­
    function parseArabicNumber(value) {
      if (!value || value.trim() === '') return 0;
      
      // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹
      const convertedValue = convertArabicToEnglishNumbers(value.toString());
      
      // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­ÙˆÙŠÙ„ Ù„Ø±Ù‚Ù…
      const number = parseFloat(convertedValue);
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø±Ù‚Ù…
      if (isNaN(number)) {
        console.log('ÙØ´Ù„ ÙÙŠ ØªØ­ÙˆÙŠÙ„:', value, 'â†’', convertedValue, 'â†’', number);
        return 0;
      }
      
      console.log('ØªØ­ÙˆÙŠÙ„ Ù†Ø§Ø¬Ø­:', value, 'â†’', convertedValue, 'â†’', number);
      return number;
    }

    // Ø­ÙØ¸ Ø§Ù„Ø£ÙƒØ³Ø³ÙˆØ§Ø±
    function demoSave() {
      // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Ø¯Ø¹Ù… Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
      const purchasePriceRaw = document.getElementById('purchase_price').value;
      const sellingPriceRaw = document.getElementById('selling_price').value;
      const quantityRaw = document.getElementById('quantity').value;
      
      const data = {
        name: document.getElementById('name').value.trim(),
        category: document.getElementById('category').value,
        description: document.getElementById('description').value.trim(),
        purchase_price: parseArabicNumber(purchasePriceRaw),
        selling_price: parseArabicNumber(sellingPriceRaw),
        quantity: parseInt(convertArabicToEnglishNumbers(quantityRaw)) || 0,
        supplier: document.getElementById('supplier').value.trim(),
        notes: document.getElementById('notes').value.trim(),
      };
      
      // Ù„Ù„ØªØ´Ø®ÙŠØµ (ÙŠÙ…ÙƒÙ† Ø­Ø°ÙÙ‡ Ù„Ø§Ø­Ù‚Ø§Ù‹)
      console.log('Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø£ØµÙ„ÙŠØ©:', {
        purchase_price: purchasePriceRaw,
        selling_price: sellingPriceRaw,
        quantity: quantityRaw
      });
      console.log('Ø§Ù„Ù‚ÙŠÙ… Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„:', {
        purchase_price: data.purchase_price,
        selling_price: data.selling_price,
        quantity: data.quantity
      });

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      if (!data.name) {
        showAlert('danger', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø£ÙƒØ³Ø³ÙˆØ§Ø±');
        return;
      }

      if (!data.category) {
        showAlert('danger', 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ¦Ø©');
        return;
      }

      if (!purchasePriceRaw || data.purchase_price <= 0) {
        showAlert('danger', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¹Ø± Ø´Ø±Ø§Ø¡ ØµØ­ÙŠØ­ (Ù…Ø«Ø§Ù„: Ù¡Ù¢Ù£.Ù¤Ù¥ Ø£Ùˆ 123.45)');
        return;
      }

      if (!sellingPriceRaw || data.selling_price <= 0) {
        showAlert('danger', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¹Ø± Ø¨ÙŠØ¹ ØµØ­ÙŠØ­ (Ù…Ø«Ø§Ù„: Ù¢Ù Ù .Ù§Ù¥ Ø£Ùˆ 200.75)');
        return;
      }

      if (!quantityRaw || data.quantity < 0) {
        showAlert('danger', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ…ÙŠØ© ØµØ­ÙŠØ­Ø© (Ù…Ø«Ø§Ù„: Ù¡Ù  Ø£Ùˆ 10)');
        return;
      }

      // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ø§Ù„Ø£ÙƒØ³Ø³ÙˆØ§Ø± Ù…Ø¹ Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯
      const accessory = {
        id: generateId(),
        name: data.name,
        category: data.category,
        description: data.description,
        purchase_price: data.purchase_price,
        selling_price: data.selling_price,
        purchase_price_with_vat: data.purchase_price * (1 + VAT_RATE),
        selling_price_with_vat: data.selling_price * (1 + VAT_RATE),
        quantity_in_stock: data.quantity,
        supplier: data.supplier,
        notes: data.notes,
        date_added: new Date().toISOString()
      };

      // Ø¬Ù„Ø¨ Ø§Ù„Ø£ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯
      const accessories = JSON.parse(localStorage.getItem('accessories') || '[]');
      accessories.push(accessory);

      // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      try {
        localStorage.setItem('accessories', JSON.stringify(accessories));
        
        showAlert('success', `ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø£ÙƒØ³Ø³ÙˆØ§Ø± "${accessory.name}" Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰`);
        
        // Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        document.querySelector('form').reset();
        
        // Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ÙˆØ§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ø£ÙˆÙ„
        setTimeout(() => {
          document.getElementById('name').focus();
        }, 1000);

      } catch (error) {
        showAlert('danger', 'ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…ØªØµÙØ­ ÙŠØ¯Ø¹Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ.');
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸:', error);
      }
    }

    function demoAddCategory() {
      const name = prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:');
      if (!name || !name.trim()) return;
      
      const categoryValue = name.trim().toLowerCase().replace(/\s+/g, '_').replace(/[Ø£-ÙŠ]/g, (char) => {
        const arabicToEnglish = {
          'Ø£': 'a', 'Ø¨': 'b', 'Øª': 't', 'Ø«': 'th', 'Ø¬': 'j', 'Ø­': 'h',
          'Ø®': 'kh', 'Ø¯': 'd', 'Ø°': 'th', 'Ø±': 'r', 'Ø²': 'z', 'Ø³': 's',
          'Ø´': 'sh', 'Øµ': 's', 'Ø¶': 'd', 'Ø·': 't', 'Ø¸': 'z', 'Ø¹': 'a',
          'Øº': 'gh', 'Ù': 'f', 'Ù‚': 'q', 'Ùƒ': 'k', 'Ù„': 'l', 'Ù…': 'm',
          'Ù†': 'n', 'Ù‡': 'h', 'Ùˆ': 'w', 'ÙŠ': 'y', 'Ø©': 'h'
        };
        return arabicToEnglish[char] || char;
      });

      // Ø¬Ù„Ø¨ Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
      const categories = JSON.parse(localStorage.getItem('accessory_categories') || '[]');
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… Ø§Ù„ØªÙƒØ±Ø§Ø±
      if (categories.find(cat => cat.text === name.trim() || cat.value === categoryValue)) {
        showAlert('warning', 'Ù‡Ø°Ù‡ Ø§Ù„ÙØ¦Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„');
        return;
      }

      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
      const newCategory = { value: categoryValue, text: name.trim() };
      categories.push(newCategory);
      
      // Ø­ÙØ¸ Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
      localStorage.setItem('accessory_categories', JSON.stringify(categories));
      
      // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
      const sel = document.getElementById('category');
      const opt = document.createElement('option');
      opt.value = categoryValue;
      opt.textContent = name.trim();
      sel.appendChild(opt);
      sel.value = categoryValue;
      
      showAlert('success', `ØªÙ… Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø© "${name.trim()}" Ø¨Ù†Ø¬Ø§Ø­!`);
    }

    function demoDeleteCategory() {
      const sel = document.getElementById('category');
      if (!sel.value) { 
        showAlert('warning', 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙØ¦Ø© Ø£ÙˆÙ„Ø§Ù‹');
        return; 
      }
      
      const selectedOption = sel.options[sel.selectedIndex];
      const categoryText = selectedOption.textContent;
      
      if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ÙØ¦Ø© "${categoryText}"ØŸ`)) return;
      
      // Ø­Ø°Ù Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
      const categories = JSON.parse(localStorage.getItem('accessory_categories') || '[]');
      const updatedCategories = categories.filter(cat => cat.value !== sel.value);
      localStorage.setItem('accessory_categories', JSON.stringify(updatedCategories));
      
      // Ø­Ø°Ù Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
      selectedOption.remove();
      
      showAlert('success', `ØªÙ… Ø­Ø°Ù ÙØ¦Ø© "${categoryText}" Ø¨Ù†Ø¬Ø§Ø­!`);
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    function checkLogin() {
      const currentUser = localStorage.getItem('current_user');
      if (!currentUser) {
        alert('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
        window.location.href = 'login.html';
        return false;
      }
      return true;
    }

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
    function logout() {
      if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
        localStorage.removeItem('current_user');
        alert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­');
        window.location.href = 'index.html';
      }
    }


    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹Ø§Øª Ù„Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© - Ø·Ø±ÙŠÙ‚Ø© Ù…Ø­Ø³Ù†Ø©
    function setupArabicNumberSupport() {
      // Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙƒÙ„Ø§Ø³ arabic-number-field
      const numberFields = document.querySelectorAll('.arabic-number-field');
      
      numberFields.forEach(field => {
        field.addEventListener('input', function() {
          const cursorPosition = this.selectionStart;
          const originalValue = this.value;
          const convertedValue = convertArabicToEnglishNumbers(originalValue);
          
          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙŠÙ…Ø© Ø¥Ø°Ø§ ØªØºÙŠØ±Øª
          if (convertedValue !== originalValue) {
            this.value = convertedValue;
            this.setSelectionRange(cursorPosition, cursorPosition);
            
            // Ø±Ø³Ø§Ù„Ø© ÙÙŠ Console Ù„Ù„ØªØ£ÙƒØ¯
            console.log(`ØªØ­ÙˆÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙÙŠ Ø­Ù‚Ù„ ${this.id}: "${originalValue}" â†’ "${convertedValue}"`);
          }
        });
        
        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø¨ØµØ±ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ±ÙƒÙŠØ²
        field.addEventListener('focus', function() {
          this.style.borderColor = '#007bff';
          this.style.boxShadow = '0 0 0 0.2rem rgba(0,123,255,.25)';
        });
        
        field.addEventListener('blur', function() {
          this.style.borderColor = '';
          this.style.boxShadow = '';
        });
      });
      
      console.log(`ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ø¯Ø¹Ù… Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù„Ù€ ${numberFields.length} Ø­Ù‚Ù„`);
    }

    // Ø­ÙØ¸ Ø§Ù„Ø£ÙƒØ³Ø³ÙˆØ§Ø± ÙÙŠ Firebase
    async function saveAccessoryToFirebase() {
      try {
        // Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        const accessoryData = {
          name: document.getElementById('name').value,
          category: document.getElementById('category').value,
          quantity: parseInt(document.getElementById('quantity').value) || 0,
          purchase_price: parseFloat(document.getElementById('purchase_price').value) || 0,
          selling_price: parseFloat(document.getElementById('selling_price').value) || 0,
          description: document.getElementById('description').value,
          supplier: document.getElementById('supplier').value,
          notes: document.getElementById('notes').value,
          date_added: new Date().toISOString()
        };

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
        if (!accessoryData.name || !accessoryData.category) {
          showAlert('danger', 'ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
          return false;
        }

        if (accessoryData.purchase_price <= 0 || accessoryData.selling_price <= 0) {
          showAlert('danger', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø£Ø³Ø¹Ø§Ø± ØµØ­ÙŠØ­Ø©');
          return false;
        }

        if (accessoryData.quantity <= 0) {
          showAlert('danger', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ…ÙŠØ© ØµØ­ÙŠØ­Ø©');
          return false;
        }

        // Ø­ÙØ¸ ÙÙŠ Firebase
        if (window.storage && window.storage.isFirebaseAvailable) {
          const accessoryId = await window.storage.addAccessory(accessoryData);
          if (accessoryId) {
            console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø£ÙƒØ³Ø³ÙˆØ§Ø± ÙÙŠ Firebase:', accessoryId);
            showAlert('success', 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£ÙƒØ³Ø³ÙˆØ§Ø± Ø¨Ù†Ø¬Ø§Ø­!');
            return true;
          }
        } else {
          // Ø­ÙØ¸ ÙÙŠ LocalStorage ÙƒØ¨Ø¯ÙŠÙ„
          const accessories = JSON.parse(localStorage.getItem('accessories') || '[]');
          accessoryData.id = Date.now().toString();
          accessories.push(accessoryData);
          localStorage.setItem('accessories', JSON.stringify(accessories));
          showAlert('success', 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£ÙƒØ³Ø³ÙˆØ§Ø± Ø¨Ù†Ø¬Ø§Ø­! (Ù…Ø­Ù„ÙŠ)');
          return true;
        }
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø£ÙƒØ³Ø³ÙˆØ§Ø±:', error);
        showAlert('danger', 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø£ÙƒØ³Ø³ÙˆØ§Ø±. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
        return false;
      }
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
    document.addEventListener('DOMContentLoaded', async function() {
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹
      if (!checkLogin()) return;

      // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Firebase
      await new Promise(resolve => setTimeout(resolve, 1000));

      await loadCategories();
      
      // Ø¥Ø¹Ø¯Ø§Ø¯ Ø¯Ø¹Ù… Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
      setupArabicNumberSupport();
      
      // Ø±Ø¨Ø· Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø¯Ø§Ù„Ø© Ø§Ù„Ø­ÙØ¸
      const form = document.querySelector('form');
      if (form) {
        form.addEventListener('submit', async (e) => {
          e.preventDefault();
          const success = await saveAccessoryToFirebase();
          if (success) {
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            form.reset();
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª
            await loadCategories();
          }
        });
      }
      
      // ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ø£ÙˆÙ„
      document.getElementById('name').focus();
    });
  </script>
</body>
</html>
