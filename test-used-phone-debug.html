<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¶Ø§ÙØ© Ù‡Ø§ØªÙ Ù…Ø³ØªØ¹Ù…Ù„</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .form-group { margin: 10px 0; }
        label { display: block; margin-bottom: 5px; }
        input, select { width: 100%; padding: 8px; margin-bottom: 10px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; }
        .log { background: #f0f0f0; padding: 10px; margin: 10px 0; font-family: monospace; }
    </style>
</head>
<body>
    <h1>Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¶Ø§ÙØ© Ù‡Ø§ØªÙ Ù…Ø³ØªØ¹Ù…Ù„</h1>
    
    <form id="testForm">
        <div class="form-group">
            <label>Ø§Ù„Ø´Ø±ÙƒØ©:</label>
            <input type="text" id="brand" value="Apple" required>
        </div>
        
        <div class="form-group">
            <label>Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„:</label>
            <input type="text" id="model" value="iPhone 13" required>
        </div>
        
        <div class="form-group">
            <label>Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡:</label>
            <input type="number" id="purchase_price" value="1000" required>
        </div>
        
        <div class="form-group">
            <label>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹:</label>
            <input type="number" id="selling_price" value="1200" required>
        </div>
        
        <div class="form-group">
            <label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ:</label>
            <input type="text" id="serial_number" value="SN123456" required>
        </div>
        
        <div class="form-group">
            <label>Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯:</label>
            <input type="text" id="barcode_input" value="123456">
        </div>
        
        <div class="form-group">
            <label>Ø­Ø§Ù„Ø© Ø§Ù„Ù‡Ø§ØªÙ:</label>
            <select id="phone_condition" required>
                <option value="excellent">Ù…Ù…ØªØ§Ø²Ø©</option>
                <option value="very_good">Ø¬ÙŠØ¯Ø© Ø¬Ø¯Ø§Ù‹</option>
                <option value="good">Ø¬ÙŠØ¯Ø©</option>
                <option value="fair">Ù…Ù‚Ø¨ÙˆÙ„Ø©</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>Ø¹Ù…Ø± Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ© (Ø¨Ø§Ù„Ø£Ø´Ù‡Ø±):</label>
            <input type="number" id="age" value="12" required>
        </div>
        
        <div class="form-group">
            <label>Ø§Ù„ÙˆØµÙ:</label>
            <input type="text" id="description" value="Ù‡Ø§ØªÙ Ù…Ø³ØªØ¹Ù…Ù„ Ø¨Ø­Ø§Ù„Ø© Ø¬ÙŠØ¯Ø©">
        </div>
        
        <div class="form-group">
            <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</label>
            <input type="text" id="customer_name" value="Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯">
        </div>
        
        <div class="form-group">
            <label>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</label>
            <input type="text" id="customer_id" value="CUST001">
        </div>
        
        <div class="form-group">
            <label>Ù„ÙˆÙ† Ø§Ù„Ù‡Ø§ØªÙ:</label>
            <input type="text" id="phone_color" value="Ø£Ø²Ø±Ù‚">
        </div>
        
        <div class="form-group">
            <label>Ø§Ù„Ø°Ø§ÙƒØ±Ø©:</label>
            <input type="text" id="phone_memory" value="128GB">
        </div>
        
        <div class="form-group">
            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØªØ±ÙŠ:</label>
            <input type="text" id="buyer_name" value="Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯">
        </div>
        
        <button type="submit">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­ÙØ¸</button>
    </form>
    
    <div id="log" class="log"></div>

    <!-- Firebase Configuration -->
    <script type="module" src="js/firebase-config.js"></script>
    <script type="module" src="js/firebase-database.js"></script>
    <script type="module" src="js/firebase-storage-manager.js"></script>

    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
            console.log(message);
        }

        // ØªÙˆÙ„ÙŠØ¯ Ø±Ù‚Ù… Ù‡Ø§ØªÙ ØªÙ„Ù‚Ø§Ø¦ÙŠ
        function generatePhoneNumber() {
            const timestamp = Date.now().toString().slice(-6);
            return timestamp.padStart(6, '0');
        }

        // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø³ØªØ¹Ù…Ù„ ÙÙŠ Firebase
        async function saveUsedPhoneToFirebase() {
            try {
                log('ğŸ”„ Ø¨Ø¯Ø¡ Ø­ÙØ¸ Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø³ØªØ¹Ù…Ù„...');
                
                // Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                const phoneData = {
                    brand: document.getElementById('brand').value,
                    model: document.getElementById('model').value,
                    condition: 'used',
                    purchase_price: parseFloat(document.getElementById('purchase_price').value) || 0,
                    selling_price: parseFloat(document.getElementById('selling_price').value) || 0,
                    serial_number: document.getElementById('serial_number').value,
                    phone_number: document.getElementById('barcode_input').value.trim() || generatePhoneNumber(),
                    phone_condition: document.getElementById('phone_condition').value,
                    age: parseInt(document.getElementById('age').value) || 0,
                    description: document.getElementById('description').value,
                    customer_name: document.getElementById('customer_name').value,
                    customer_id: document.getElementById('customer_id').value,
                    phone_color: document.getElementById('phone_color').value,
                    phone_memory: document.getElementById('phone_memory').value,
                    buyer_name: document.getElementById('buyer_name').value,
                    date_added: new Date().toISOString()
                };

                log('ğŸ“± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‡Ø§ØªÙ: ' + JSON.stringify(phoneData, null, 2));

                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                if (!phoneData.brand || !phoneData.model || !phoneData.serial_number) {
                    log('âŒ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø·Ù„ÙˆØ¨Ø© Ù…ÙÙ‚ÙˆØ¯Ø©');
                    alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                    return false;
                }

                if (phoneData.purchase_price <= 0 || phoneData.selling_price <= 0) {
                    log('âŒ Ø£Ø³Ø¹Ø§Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
                    alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø£Ø³Ø¹Ø§Ø± ØµØ­ÙŠØ­Ø©');
                    return false;
                }

                if (!phoneData.phone_condition) {
                    log('âŒ Ø­Ø§Ù„Ø© Ø§Ù„Ù‡Ø§ØªÙ Ù…Ø·Ù„ÙˆØ¨Ø©');
                    alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ù‡Ø§ØªÙ');
                    return false;
                }

                log('âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©');

                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Firebase
                if (window.storage && window.storage.isFirebaseAvailable) {
                    log('ğŸ”¥ Firebase Ù…ØªØ§Ø­ØŒ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ÙØ¸...');
                    const phoneId = await window.storage.addPhone(phoneData);
                    if (phoneId) {
                        log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø³ØªØ¹Ù…Ù„ ÙÙŠ Firebase: ' + phoneId);
                        alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø³ØªØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­!');
                        return true;
                    } else {
                        log('âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ID Ù…Ù† Firebase');
                        return false;
                    }
                } else {
                    log('ğŸ’¾ Firebase ØºÙŠØ± Ù…ØªØ§Ø­ØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… LocalStorage...');
                    // Ø­ÙØ¸ ÙÙŠ LocalStorage ÙƒØ¨Ø¯ÙŠÙ„
                    const phones = JSON.parse(localStorage.getItem('phones') || '[]');
                    phoneData.id = Date.now().toString();
                    phones.push(phoneData);
                    localStorage.setItem('phones', JSON.stringify(phones));
                    log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø³ØªØ¹Ù…Ù„ ÙÙŠ LocalStorage');
                    alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø³ØªØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­! (Ù…Ø­Ù„ÙŠ)');
                    return true;
                }
            } catch (error) {
                log('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø³ØªØ¹Ù…Ù„: ' + error.message);
                log('âŒ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£: ' + error.stack);
                alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù‡Ø§ØªÙ. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
                return false;
            }
        }

        // Ø±Ø¨Ø· Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
        document.addEventListener('DOMContentLoaded', async () => {
            log('ğŸ”„ Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Firebase...');
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            if (window.storage) {
                log('âœ… Storage Manager Ù…Ø­Ù…Ù„');
                log('ğŸ”¥ Firebase Ù…ØªØ§Ø­: ' + window.storage.isFirebaseAvailable);
            } else {
                log('âŒ Storage Manager ØºÙŠØ± Ù…Ø­Ù…Ù„');
            }
            
            const form = document.getElementById('testForm');
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                log('ğŸ“ Ø¨Ø¯Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬...');
                const success = await saveUsedPhoneToFirebase();
                if (success) {
                    log('ğŸ‰ ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!');
                } else {
                    log('ğŸ’¥ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­ÙØ¸');
                }
            });
        });
    </script>
</body>
</html>
